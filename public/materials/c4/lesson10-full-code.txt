קוד מקור מלא - צ'אטבוט מקצה לקצה
===================================

דוגמה מלאה של צ'אטבוט
=======================

```python
import google.generativeai as genai
import os
import logging
import json
import time
from datetime import datetime

# הגדרת Logging
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    handlers=[
        logging.FileHandler("chatbot.log"),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# הגדרת API
genai.configure(api_key=os.getenv("GEMINI_API_KEY"))

class Chatbot:
    def __init__(self):
        """אתחל צ'אטבוט"""
        self.model = genai.GenerativeModel(
            model_name="gemini-1.5-flash",
            generation_config={
                "temperature": 0.7,
                "top_p": 0.95,
                "top_k": 40,
                "max_output_tokens": 2000
            },
            safety_settings=[
                {
                    "category": "HARM_CATEGORY_HATE_SPEECH",
                    "threshold": "BLOCK_MEDIUM_AND_ABOVE"
                },
                {
                    "category": "HARM_CATEGORY_HARASSMENT",
                    "threshold": "BLOCK_MEDIUM_AND_ABOVE"
                },
                {
                    "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                    "threshold": "BLOCK_MEDIUM_AND_ABOVE"
                },
                {
                    "category": "HARM_CATEGORY_DANGEROUS_CONTENT",
                    "threshold": "BLOCK_MEDIUM_AND_ABOVE"
                }
            ],
            system_instruction="""אתה עוזר AI ידידותי ומקצועי.
תמיד תן תשובות מפורטות ומועילות.
היה מנומס וסבלני.
אם אתה לא יודע משהו, אמור זאת בכנות."""
        )
        self.chat = None
        self.conversation_history = []
        self.request_count = 0
        self.error_count = 0
    
    def start_chat(self):
        """התחל שיחה חדשה"""
        self.chat = self.model.start_chat(history=[])
        self.conversation_history = []
        logger.info("New chat started")
    
    def send_message(self, message, max_retries=3):
        """שלח הודעה עם retry logic"""
        if not self.chat:
            self.start_chat()
        
        self.request_count += 1
        
        # Validate input
        if not message or not message.strip():
            return {
                "success": False,
                "error": "הודעה ריקה"
            }
        
        if len(message) > 10000:
            return {
                "success": False,
                "error": "הודעה ארוכה מדי"
            }
        
        # נסה לשלוח עם retry
        for attempt in range(max_retries):
            try:
                logger.info(f"Sending message (attempt {attempt + 1}): {message[:50]}...")
                start_time = time.time()
                
                response = self.chat.send_message(message)
                
                duration = time.time() - start_time
                logger.info(f"Message processed in {duration:.2f} seconds")
                
                # שמור היסטוריה
                self.conversation_history.append({
                    "user": message,
                    "bot": response.text,
                    "timestamp": datetime.now().isoformat()
                })
                
                return {
                    "success": True,
                    "text": response.text,
                    "duration": duration
                }
                
            except Exception as e:
                self.error_count += 1
                logger.error(f"Error (attempt {attempt + 1}): {e}")
                
                if attempt < max_retries - 1:
                    wait_time = 2 ** attempt
                    logger.info(f"Retrying in {wait_time} seconds...")
                    time.sleep(wait_time)
                    continue
                
                return {
                    "success": False,
                    "error": "מצטער, הייתה שגיאה. אנא נסה שוב."
                }
        
        return {
            "success": False,
            "error": "נכשל אחרי כל הניסיונות"
        }
    
    def get_stats(self):
        """קבל סטטיסטיקות"""
        return {
            "total_requests": self.request_count,
            "errors": self.error_count,
            "success_rate": (self.request_count - self.error_count) / self.request_count if self.request_count > 0 else 0,
            "conversation_length": len(self.conversation_history)
        }
    
    def save_conversation(self, filename="conversation.json"):
        """שמור שיחה"""
        with open(filename, "w", encoding="utf-8") as f:
            json.dump(self.conversation_history, f, ensure_ascii=False, indent=2)
        logger.info(f"Conversation saved to {filename}")

def main():
    """פונקציה ראשית"""
    chatbot = Chatbot()
    
    print("=" * 50)
    print("צ'אטבוט AI - ברוכים הבאים!")
    print("כתוב 'יציאה' או 'exit' לסיום")
    print("=" * 50)
    print()
    
    chatbot.start_chat()
    
    while True:
        try:
            user_input = input("אתה: ").strip()
            
            if user_input.lower() in ["exit", "quit", "יציאה", "סיום"]:
                print("\nצ'אטבוט: להתראות! היה נחמד לדבר איתך.")
                break
            
            if not user_input:
                continue
            
            result = chatbot.send_message(user_input)
            
            if result["success"]:
                print(f"\nצ'אטבוט: {result['text']}\n")
            else:
                print(f"\nשגיאה: {result['error']}\n")
                
        except KeyboardInterrupt:
            print("\n\nצ'אטבוט: להתראות!")
            break
        except Exception as e:
            logger.error(f"Unexpected error: {e}")
            print(f"\nשגיאה לא צפויה: {e}\n")
    
    # הצג סטטיסטיקות
    stats = chatbot.get_stats()
    print("\n" + "=" * 50)
    print("סטטיסטיקות:")
    print(f"  בקשות כוללות: {stats['total_requests']}")
    print(f"  שגיאות: {stats['errors']}")
    print(f"  שיעור הצלחה: {stats['success_rate']:.2%}")
    print(f"  אורך שיחה: {stats['conversation_length']} הודעות")
    print("=" * 50)
    
    # שמור שיחה
    chatbot.save_conversation()

if __name__ == "__main__":
    main()
```

שימוש:
------
1. הגדר GEMINI_API_KEY ב-environment
2. הרץ: python chatbot.py
3. התחל לשוחח!

תכונות:
--------
✓ System Instructions
✓ Configuration
✓ Safety Settings
✓ Error Handling
✓ Retry Logic
✓ Logging
✓ Conversation History
✓ Statistics
✓ Save/Load

---
© 2026 Google AI Academy
קוד מקור מלא - צ'אטבוט מקצה לקצה